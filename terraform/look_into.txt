# Iterate over local.account_access to create custom permission sets
resource "aws_ssoadmin_permission_set" "custom_permission_sets" {
  for_each = { for group in local.account_access : group.group_name => group }

  instance_arn = tolist(data.aws_ssoadmin_instances.example.arns)[0]
  name         = each.key
  description  = "Custom permission set for ${each.key}"

  # Optional: Attach inline policies here if needed
  inline_policy {
    document = jsonencode({
      statement {
        sid       = "1"
        effect    = "Allow"
        actions   = ["s3:ListAllMyBuckets", "s3:GetBucketLocation"]
        resources = ["arn:aws:s3:::*"]
      }
    })
  }
}